<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body class="bg-gray-50 font-sans" x-data="shopFront()">

    <div x-show="loading" class="h-screen flex items-center justify-center">Loading...</div>

    <div x-show="!loading && valid">
        <!-- Header -->
        <header class="text-white shadow p-4" :style="`background-color: ${settings.color}`">
            <div class="container mx-auto flex justify-between">
                <h1 class="font-bold text-xl" x-text="settings.name"></h1>
                <button>Cart (0)</button>
            </div>
        </header>

        <!-- Hero -->
        <div class="bg-gray-800 text-white py-20 text-center">
            <h2 class="text-4xl font-bold" x-text="settings.hero"></h2>
        </div>

        <!-- Products -->
        <div class="container mx-auto p-8 grid grid-cols-1 md:grid-cols-4 gap-6">
            <template x-for="p in products">
                <div class="bg-white rounded shadow overflow-hidden">
                    <img :src="p.image" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold" x-text="p.name"></h3>
                        <p class="text-lg font-bold text-blue-600">$<span x-text="p.price"></span></p>
                        <button class="bg-gray-900 text-white w-full py-2 mt-2 rounded">Buy Now</button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        function shopFront() {
            return {
                loading: true,
                valid: false,
                settings: {name:'', hero:'', color:'#333'},
                products: [],

                init() {
                    const id = new URLSearchParams(window.location.search).get('id');
                    if(id) this.loadStore(id);
                },

                async loadStore(uid) {
                    try {
                        const doc = await db.collection('users').doc(uid).get();
                        if(doc.exists) {
                            this.valid = true;
                            if(doc.data().settings) this.settings = doc.data().settings;
                            const snap = await db.collection('users').doc(uid).collection('products').get();
                            this.products = snap.docs.map(d => d.data());
                        }
                    } catch(e) {}
                    this.loading = false;
                }
            }
        }
    </script>
</body>
</html>
